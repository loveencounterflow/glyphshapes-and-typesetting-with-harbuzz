{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/demo-harfbuzz.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DEMO-HARFBUZZ'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nFS                        = require 'fs'\nPATH                      = require 'path'\nSEMVER                    = require 'semver'\nSHELL                     = require 'shelljs'\nSP                        = require 'steampipes'\n{ $\n  $async\n  $watch\n  $show\n  $drain }                = SP.export()\nDATOM                     = require 'datom'\n{ new_datom\n  freeze    }             = DATOM.export()\n{ spawn }                 = require 'child_process'\n@types                    = require './__OLD__types'\n{ isa\n  validate\n  type_of  }              = @types.export()\n\n\n\n\n#===========================================================================================================\n# ENSURE HARFBUZZ INSTALLED\n#-----------------------------------------------------------------------------------------------------------\n@_show_shell_output = ( output ) ->\n  echo()\n  help '^demo-harfbuzz@100^ stdout:', ( rpr output.stdout ) if output.stdout? and output.stdout.length > 0\n  warn '^demo-harfbuzz@101^ stderr:', ( rpr output.stderr ) if output.stderr? and output.stderr.length > 0\n  echo()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@ensure_harfbuzz_version = ->\n  cmds = [\n    'hb-shape'\n    'hb-view' ]\n  #.........................................................................................................\n  for cmd in cmds\n    output = SHELL.exec \"#{cmd} --version\", { silent: ( not @types.defaults.internal.verbose ), }\n    #.......................................................................................................\n    unless output.code is 0\n      @_show_shell_output output\n      throw new Error \"^demo-harfbuzz@102^ ensure that harfbuzz is available on the path (recommendation: `homebrew install harfbuzz` on Linux, Mac)\"\n    pattern = /// ^ #{cmd} \\s+ \\(HarfBuzz\\) \\s+ (?<version>[0-9a-z.]+) \\n ///\n    #.......................................................................................................\n    unless ( match = output.stdout.match pattern )?\n      @_show_shell_output output\n      throw new Error \"^demo-harfbuzz@103^ ensure that harfbuzz is available on the path (recommendation: `homebrew install harfbuzz` on Linux, Mac)\"\n    #.......................................................................................................\n    unless SEMVER.satisfies match.groups.version, @types.defaults.internal.harfbuzz.semver\n      @_show_shell_output output\n      throw new Error \"^demo-harfbuzz@104^ found HarfBuzz #{rpr cmd} version #{rpr match.groups.version}, expected #{rpr @types.defaults.internal.harfbuzz.semver}\"\n    #.......................................................................................................\n    whisper \"^33787^ #{cmd} version #{match.groups.version} OK\" if @types.defaults.internal.verbose\n  #.........................................................................................................\n  return null\n\n#===========================================================================================================\n# HELPERS\n#-----------------------------------------------------------------------------------------------------------\n@_features_as_text = ( features ) ->\n  ### Turn feature object like `{ liga: true, clig: true, dlig: true, hlig: true, }` into feature strings\n  like `'liga,clig,dlig,hlig'` ###\n  return features if isa.text features\n  R = []\n  for feature, value of features\n    R.push switch ( type = type_of value )\n      when 'boolean'  then if value is true then feature else \"#{feature}=false\"\n      when 'text'     then if value is ''   then feature else \"#{feature}=#{value}\"\n      when 'number'   then \"#{feature}=#{value}\"\n      else throw new Error \"^demo-harfbuzz@104^ unable to convert a #{type} into a feature string\"\n  return R.join ','\n\n\n#===========================================================================================================\n# ARRANGEMENT\n#-----------------------------------------------------------------------------------------------------------\n@$extract_hbshape_positioning = ( cfg ) ->\n  return $ ( d, send ) ->\n    return null unless d.$key is '^stdout'\n    return null unless d.$value?\n    ### NOTE first try simple format, then format that includes line numbers ###\n    unless ( match = d.$value.match /^(?<positions>\\[.*\\])$/ )?\n      return null unless ( match = d.$value.match /^(?<lnr>[0-9]+):\\s+(?<positions>\\[.*\\])$/ )?\n    send JSON.parse match.groups.positions\n\n#-----------------------------------------------------------------------------------------------------------\n@$convert_shape_datoms = ( cfg ) ->\n  symid         = null\n  path_start    = '<path style=\"stroke:none;\" d=\"'\n  path_end      = ' \"/>'\n  use_pattern   = /^<use xlink:href=\"#(?<symid>[^\"]+)\" x=\"(?<dx>[^\"]+)\" y=\"(?<dy>[^\"]+)\"\\/>/\n  use_idx       = -1\n  #.........................................................................................................\n  return $ ( d, send ) ->\n    return null unless d.$key is '^stdout'\n    return null unless ( value = d.$value )?\n    return null if ( value.match /^<\\// )?\n    return null if value is '<defs>'\n    return null if value is '<g>'\n    return null if value.startsWith '<?xml '\n    return null if value.startsWith '<g '\n    return null if value.startsWith '<rect ' ### NOTE could extract visual text extent from background box ###\n    #.......................................................................................................\n    if value.startsWith '<svg '\n      ### NOTE may want to extract width, height, viewBox ###\n      return null\n    #.......................................................................................................\n    if value.startsWith '<symbol '\n      ### TAINT validate that symid was found ###\n      symid = value.replace /^.*\\sid=\"([^\"]+)\".*$/, '$1'\n      return null\n    # #.......................................................................................................\n    # if value.startsWith '<clipPath '\n    #   ### NOTE only occurs on very long lines ###\n    #   ### TAINT can we indeed ignore it? ###\n    #   return null\n    #.......................................................................................................\n    if value is '<path style=\"stroke:none;\" d=\"\"/>'\n      send new_datom '^glyfpath', { symid, glyfpath: '', glyfname: 'space', }\n      return null\n    #.......................................................................................................\n    value = value.trimLeft()\n    # #.......................................................................................................\n    # if value.startsWith '<path d='\n    #   debug '^33334^', value\n    #   return null\n    #.......................................................................................................\n    if ( value.startsWith path_start ) and ( value.endsWith path_end )\n      glyfpath = value[ path_start.length ... value.length - path_end.length ]\n      send new_datom '^glyfpath', { symid, glyfpath, }\n      return null\n    #.......................................................................................................\n    if ( match = value.match use_pattern )?\n      use_idx++\n      data = match.groups\n      if cfg.arrangement?\n        unless ( data.glyfname = cfg.arrangement[ use_idx ]?.g ? null )?\n          throw new Error \"^demo-harfbuzz@105^ passed arrangement but use_idx #{use_idx} has no entry\"\n      send new_datom '^use', data\n      return null\n    #.......................................................................................................\n    throw new Error \"^demo-harfbuzz@106^ unexpected SVG element #{rpr value}\"\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$consolidate_shape_datoms = ( cfg ) ->\n  last            = Symbol 'last'\n  path_by_symid   = {}\n  R               = {}\n  #.........................................................................................................\n  return $ { last, }, ( d, send ) ->\n    if d is last\n      # whisper '^6667^', path_by_symid\n      return send R\n    #.......................................................................................................\n    # whisper '^784^', d\n    # whisper '^784^', ( k for k of path_by_symid )\n    switch d.$key\n      when '^glyfpath'\n        path_by_symid[ d.symid ] = d.glyfpath\n      when '^use'\n        return null unless ( glyfname = d.glyfname )?\n        unless ( glyfpath = path_by_symid[ d.symid ] )?\n          throw new Error \"^demo-harfbuzz@107^ unable to locate glyfpath for glyfname #{glyfname}\"\n        R[ glyfname ] = glyfpath\n      else\n        throw new Error \"^demo-harfbuzz@108^ unexpected datom #{rpr d}\"\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$show_positionings = ( cfg ) ->\n  last      = Symbol 'last'\n  count     = 0\n  #.........................................................................................................\n  return $watch { last, }, ( d ) ->\n    if d is last\n      urge CND.reverse \"found #{count} glyph positionings\"\n      return null\n    return null unless isa.list d\n    count += d.length\n    for shape in d\n      info shape\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n### TAINT add styling, font features ###\n@arrange_text = ( cfg ) -> new Promise ( resolve, reject ) =>\n  cfg           = { @types.defaults.hb_cfg..., cfg..., }\n  validate.hb_cfg cfg\n  { text\n    font      } = cfg\n  { path\n    features }  = font\n  #.........................................................................................................\n  ### TAINT code duplication ###\n  ### TAINT cache parameters, esp. features ###\n  parameters    = []\n  parameters.push '--output-format=json'\n  parameters.push '--font-size=1000'\n  parameters.push \"--features=#{@_features_as_text font.features}\" if font.features?\n    # '--no-glyph-names' ### NOTE when active, output glyf IDs instead of glyph names ###\n    # '--show-extents'\n    # '--show-flags'\n    # '--verbose'\n  parameters.push font.path\n  parameters.push text\n  #.........................................................................................................\n  cp              = spawn 'hb-shape', parameters\n  stream_settings = { bare: true, }\n  source          = SP.source_from_child_process cp, stream_settings\n  pipeline        = []\n  pipeline.push source\n  pipeline.push SP.$split_channels()\n  pipeline.push SP.$select '^stderr', ( d ) -> reject new Error d.$value\n  ( pipeline.push $watch ( d ) => whisper '^33344^', d ) if @types.defaults.internal.verbose\n  pipeline.push @$extract_hbshape_positioning cfg\n  ( pipeline.push @$show_positionings           cfg ) if @types.defaults.internal.verbose\n  pipeline.push $drain ( R ) =>\n    urge \"arrange_text finished\" if @types.defaults.internal.verbose\n    resolve R.flat Infinity\n  SP.pull pipeline...\n  #.........................................................................................................\n  return null\n\n\n#===========================================================================================================\n# FETCH OUTLINES\n#-----------------------------------------------------------------------------------------------------------\n@$show_usage_counts = ( cfg ) ->\n  last      = Symbol 'last'\n  count     = 0\n  #.........................................................................................................\n  return $watch { last, }, ( d ) ->\n    if d is last\n      urge CND.reverse \"found #{count} usage tags\"\n      return null\n    return null unless d.$key is '^use'\n    count++\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@fetch_outlines = ( cfg ) ->\n  cfg      = { @types.defaults.hb_cfg..., cfg..., }\n  validate.hb_cfg cfg\n  return @fetch_outlines_fast cfg\n\n#-----------------------------------------------------------------------------------------------------------\n@fetch_outlines_fast = ( cfg ) -> new Promise ( resolve, reject ) =>\n  { text\n    font\n    arrangement } = cfg\n  #.........................................................................................................\n  ### TAINT code duplication ###\n  ### TAINT cache parameters, esp. features ###\n  parameters    = []\n  parameters.push '--output-format=svg'\n  parameters.push '--font-size=1000'\n  parameters.push \"--features=#{@_features_as_text font.features}\" if font.features?\n  parameters.push font.path\n  parameters.push text\n    # '--show-extents'\n    # '--show-flags'\n    # '--verbose'\n  #.........................................................................................................\n  cp              = spawn 'hb-view', parameters\n  stream_settings = { bare: true, }\n  source          = SP.source_from_child_process cp, stream_settings\n  pipeline        = []\n  pipeline.push source\n  pipeline.push SP.$split_channels()\n  pipeline.push SP.$select '^stderr', ( d ) -> reject new Error d.$value\n  pipeline.push @$convert_shape_datoms      cfg\n  ( pipeline.push @$show_usage_counts         cfg ) if @types.defaults.internal.verbose\n  pipeline.push @$consolidate_shape_datoms  cfg\n  ( pipeline.push $show() ) if @types.defaults.internal.verbose\n  pipeline.push $drain ( R ) =>\n    urge \"fetch_outlines finished\" if @types.defaults.internal.verbose\n    resolve R[ 0 ]\n  SP.pull pipeline...\n  #.........................................................................................................\n  return null\n\n\n#===========================================================================================================\n# HIGH-LEVEL API\n#-----------------------------------------------------------------------------------------------------------\n@shape_text = ( cfg ) ->\n  arrangement           = await @arrange_text cfg\n  cfg                   = { cfg..., arrangement, }\n  ### TAINT forego outlining for the sake of benchmarking ###\n  # outlines              = await @fetch_outlines_fast cfg\n  outlines              = null\n  return { arrangement, outlines, }\n\n\n#===========================================================================================================\n# DEMO\n#-----------------------------------------------------------------------------------------------------------\n@demo_arranging_and_outlining_text = ( cfg ) ->\n  HB                    = @\n  HB.ensure_harfbuzz_version()\n  font                  =\n    path:                 'EBGaramond12-Italic.otf'\n    features:             { liga: true, clig: true, dlig: true, hlig: true, }\n  font.path             = PATH.resolve PATH.join __dirname, '../fonts', font.path\n  # text                  = \"A glyph ffi shaping\\nagffix谷\"\n  # text                  = \"A abc\\nabc ffl ffi ct 谷 Z\"\n  # text                  = \"AThctZ\"\n  text                  = \"A x Z\"\n  cfg                   = { font, text, }\n  arrangement           = await HB.arrange_text cfg\n  #.........................................................................................................\n  ### At this point we could check outline DB for missing outlines using the Glyf Names in `arrangement`.\n\n  If all outlines are found then we're fine to procede; in case one or more outlines are missing, we have to\n  typeset *the entire text* (unfortunately) again using `hb-view` with SVG output. We update `cfg` with\n  `arrangement` because only then it is possible to match outlines and Glyph Names. ###\n  #.........................................................................................................\n  cfg                   = { cfg..., arrangement, }\n  outlines              = await HB.fetch_outlines cfg\n  for d in arrangement\n    help d\n  for glyfname, outline of outlines\n    urge ( CND.pen { glyfname, d: outline, } ).trim()[ ... 100 ] + '…'\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  @demo_arranging_and_outlining_text()\n  # @ensure_harfbuzz_version()\n  # help await @shape_text { font: { path: '/home/flow/jzr/glyphshapes-and-typesetting-with-harfbuzz/fonts/EBGaramond12-Italic.otf', features: 'liga,clig,dlig,hlig' }, text: 'AxZ' }\n  # help await @shape_text { font: { path: 'nosuchfile', features: 'liga,clig,dlig,hlig' }, text: 'AxZ' }\n\n"
  ]
}